# Practical Exercise 10 – Using Functions in Workflows / Ćwiczenie praktyczne 10 – Używanie Functions w workflowach

## English

### Exercise Description
In this practical exercise, our goal is to work with different functions, both general purpose as well as status checks, to get familiar with the feature.

Here are the instructions for the exercise:

1. Create a file named `09-functions.yaml` under the `.github/workflows` folder at the root of your repository.
2. Name the workflow `09 – Using Functions`.
3. Add the following triggers with event filters and activity types to your workflow:
   a. `pull_request`  
   b. `workflow_dispatch`
4. Add a single job named `echo1` to the workflow. The job should run on `ubuntu-latest` and should contain five steps:
   a. The first step, named `Failing step`, should exit with a non‑zero code.  
   b. The second step, named `I will be skipped`, should execute only if the previous steps have successfully completed. It should print the following text: "I will print if previous steps succeed."  
   c. The third step, named `I will execute`, should execute only if any of the previous steps have failed. It should print the following text: "I will print if any previous step fails."  
   d. The fourth step, also named `I will execute`, should execute only if the workflow has not been cancelled. It should print the following text: "I will always print, except when the workflow is cancelled."  
   e. The fifth step, named `I will execute when cancelled`, should execute only when the workflow has been cancelled.
5. Commit the changes and push the code. Trigger the workflow from the UI and take a few moments to inspect the result of the workflow run. Which steps executed?
6. Add a new step named `Sleep for 20 seconds` before the first step of the job. The step should run the `sleep 20` shell command. This gives you some time to cancel the workflow manually from the UI.
7. Commit the changes and push the code. Trigger the workflow from the UI and quickly cancel the workflow by clicking on the three dots at the right of the row containing the workflow run information. Take a few moments to inspect the result of the workflow run. Which steps executed?
8. Last but not least, let's work with some information from pull requests. For that:
   a. Add three steps at the very beginning of the job (before the sleep step).  
   b. The first step, named `Print PR title`, should simply print the title of the PR to the screen.  
   c. The second step, named `Print PR labels`, should print any labels present on the PR.  
      i. The label information is available under the `github.event.pull_request.labels` context.  
      ii. The information should be printed in a nicely formatted JSON string. If you are not sure how to do that, check the Tips section below.  
   d. The third step, named `Bug step`, should execute if any previous steps have failed (but not if the workflow has been cancelled) **and** if the PR title contains the string `fix`. It should print the line `"I am a bug fix"`.
9. Commit the changes and push the code.
10. Open a pull request by introducing some dummy changes to the root `README.md` file and committing the changes to a new branch. Take a few moments to inspect the result of the workflow run.
11. Test closing and reopening the PR with a different title, now including the string `fix`. How has this impacted the output of the workflow run?
12. Change the workflow triggers to contain only `workflow_dispatch` to prevent this workflow from running with every push and pollute the list of workflow runs.

### Tips

**Printing multi‑line JSON strings**  
To print a multi‑line JSON string from the `toJSON` GitHub function, you can use the following pattern:

```yaml
steps:
- name: Print PR labels
  run: |
    cat << EOF
    ${{ toJSON(github.event.pull_request.labels) }}
    EOF
```

---

## Polski

### Opis ćwiczenia
W tym ćwiczeniu naszym celem jest praca z różnymi funkcjami — zarówno ogólnego przeznaczenia, jak też kontrolami statusu — aby oswoić się z tą funkcjonalnością.

Oto instrukcje do ćwiczenia:

1. Utwórz plik o nazwie `09-functions.yaml` w folderze `.github/workflows` w katalogu głównym repozytorium.
2. Nazwij workflow `09 – Using Functions`.
3. Dodaj do workflow następujące wyzwalacze z filtrami zdarzeń i typami aktywności:
   a. `pull_request`  
   b. `workflow_dispatch`
4. Dodaj do workflow pojedynczą pracę (job) o nazwie `echo1`. Job powinien działać na `ubuntu-latest` i zawierać pięć kroków:
   a. Pierwszy krok, nazwany `Failing step`, powinien zakończyć się kodem innym niż zero.  
   b. Drugi krok, nazwany `I will be skipped`, powinien wykonać się tylko wtedy, gdy poprzednie kroki zakończyły się powodzeniem. Powinien wypisać tekst: "I will print if previous steps succeed."  
   c. Trzeci krok, nazwany `I will execute`, powinien wykonać się tylko wtedy, gdy którykolwiek z poprzednich kroków zakończył się niepowodzeniem. Powinien wypisać: "I will print if any previous step fails."  
   d. Czwarty krok, również nazwany `I will execute`, powinien wykonać się tylko wtedy, gdy workflow nie został anulowany. Powinien wypisać: "I will always print, except when the workflow is cancelled."  
   e. Piąty krok, nazwany `I will execute when cancelled`, powinien wykonać się tylko wtedy, gdy workflow został anulowany.
5. Zacommituj zmiany i wypchnij kod. Uruchom workflow z interfejsu UI i poświęć chwilę na przejrzenie wyniku uruchomienia. Które kroki się wykonały?
6. Dodaj nowy krok o nazwie `Sleep for 20 seconds` przed pierwszym krokiem joba. Krok powinien uruchomić polecenie powłoki `sleep 20`. Da Ci to czas na ręczne anulowanie workflow z UI.
7. Zacommituj zmiany i wypchnij kod. Uruchom workflow z UI i szybko anuluj go, klikając trzy kropki po prawej stronie wiersza z informacją o uruchomieniu workflow. Poświęć chwilę na przejrzenie wyniku. Które kroki się wykonały?
8. Na koniec popracujmy z informacjami z pull requestów. W tym celu:
   a. Dodaj trzy kroki na samym początku joba (przed krokiem „sleep”).  
   b. Pierwszy krok, nazwany `Print PR title`, powinien po prostu wypisać tytuł PR na ekran.  
   c. Drugi krok, nazwany `Print PR labels`, powinien wypisać etykiety (labels) obecne na PR.  
      i. Informacje o etykietach są dostępne w kontekście `github.event.pull_request.labels`.  
      ii. Informacje powinny zostać wypisane w ładnie sformatowanym ciągu JSON. Jeśli nie wiesz, jak to zrobić, zajrzyj do sekcji Porady poniżej.  
   d. Trzeci krok, nazwany `Bug step`, powinien wykonać się, jeśli którykolwiek z poprzednich kroków zakończył się niepowodzeniem (ale nie, jeśli workflow został anulowany) **oraz** jeśli tytuł PR zawiera ciąg `fix`. Powinien wypisać linię `"I am a bug fix"`.
9. Zacommituj zmiany i wypchnij kod.
10. Otwórz pull request, wprowadzając przykładowe zmiany do pliku `README.md` w katalogu głównym i commitując je na nową gałąź. Poświęć chwilę, aby przejrzeć wynik uruchomienia workflow.
11. Przetestuj zamknięcie i ponowne otwarcie PR z innym tytułem, tym razem zawierającym ciąg `fix`. Jak wpłynęło to na wynik uruchomienia workflow?
12. Zmień wyzwalacze workflow tak, aby zawierały tylko `workflow_dispatch`, aby zapobiec uruchamianiu tego workflow przy każdym pushu i zaśmiecaniu listy uruchomień.

### Porady

**Wypisywanie wielowierszowych ciągów JSON**  
Aby wypisać wielowierszowy ciąg JSON z funkcji GitHub `toJSON`, możesz użyć następującego wzorca:

```yaml
steps:
- name: Print PR labels
  run: |
    cat << EOF
    ${{ toJSON(github.event.pull_request.labels) }}
    EOF
```
