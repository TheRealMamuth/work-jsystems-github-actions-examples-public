
# Practical Exercise 16 - Using Multiple Jobs for Better Caching Functionality / Ćwiczenie praktyczne 16 – Użycie wielu zadań dla lepszego działania buforowania

---

## **English Version**

### Exercise Description

In this practical exercise, our goal is to explore how we can use a dedicated job for caching so that it prevents the parallel installation of dependencies once the `package-lock.json` file changes.

In order to achieve that, we will extend the workflow `13-caching.yaml`.  
Here are the instructions for the exercise:

1. **Add a new job named `install-deps`:**
   a. The job should run on `ubuntu-latest`.  
   b. The job should set `13-caching/react-app` as the default `working-directory` option for `run` commands.  
   c. The job should contain five steps:  
      i. The first one, named **Checkout code**, should checkout the repository code into the current working directory.  
      ii. The second one, named **Setup Node**, should setup Node with the version provided as an input.  
      iii. The third one, named **Calculate cache key**, should have an id of `cache-key` and generate an output named `CACHE_KEY` with the value:  
         ```yaml
         deps-node-modules-${{ hashFiles('13-caching/react-app/package-lock.json') }}
         ```  
      iv. The fourth one should be similar to the already implemented **Download cached dependencies** step, but it should use the output of the `cache-key` step instead of hard-coding the cache key.  
      v. The fifth one should be similar to the already implemented **Install dependencies** step.  
   d. The job should contain a single output named `deps-cache-key`, and its value should come from the `CACHE_KEY` output of the `cache-key` step.

2. **Add a new job named `linting`:**
   a. The job should run on `ubuntu-latest`.  
   b. The job should run if and only if the `install-deps` job successfully completes.  
   c. The job should set `13-caching/react-app` as the default `working-directory` option for `run` commands.  
   d. The job should contain five steps:  
      i. The first one, named **Checkout code**, should checkout the repository code into the current working directory.  
      ii. The second one, named **Setup Node**, should setup Node with the version provided as an input.  
      iii. The third one should be similar to the already implemented **Download cached dependencies** step, but it should use the output of the `install-deps` job instead of hard-coding the cache key, and it should not depend on the `use-cache` input.  
      iv. The fourth one, named **Testing**, should run the `npm run test` script.  
      v. The fifth one, named **Linting**, should print `"Linting..."` on the screen.

3. **Modify the `build` job:**
   a. Add a dependency to the `install-deps` job.  
   b. Remove the **Install dependencies** step, since dependencies will always come from the cache.  
   c. Update the **Download cached dependencies** step to use the output of the `install-deps` job instead of hard-coding the cache key.  
      Additionally, it should not be influenced by the `use-cache` input anymore, since the cache becomes necessary for the correct execution of the job.

4. **Commit the changes and push the code.**  
   Trigger the workflow a few times and inspect the running times of each step.  
   How much time does it take to install the dependencies? How much time would it take if the workflow ran 1000 times?

---

## **Wersja polska**

### Opis ćwiczenia

W tym ćwiczeniu praktycznym naszym celem jest zbadanie, jak można wykorzystać osobne zadanie do buforowania, aby zapobiec równoległej instalacji zależności po zmianie pliku `package-lock.json`.

Aby to osiągnąć, rozszerzymy workflow `13-caching.yaml`.  
Oto instrukcje do ćwiczenia:

1. **Dodaj nowe zadanie o nazwie `install-deps`:**
   a. Zadanie powinno działać na `ubuntu-latest`.  
   b. Powinno ustawić `13-caching/react-app` jako domyślny katalog roboczy (`working-directory`) dla poleceń `run`.  
   c. Powinno zawierać pięć kroków:  
      i. Pierwszy krok – **Checkout code** – pobiera kod repozytorium do bieżącego katalogu roboczego.  
      ii. Drugi krok – **Setup Node** – ustawia wersję Node zgodnie z przekazanym parametrem.  
      iii. Trzeci krok – **Calculate cache key** – powinien mieć identyfikator `cache-key` i generować wynik `CACHE_KEY` o wartości:  
         ```yaml
         deps-node-modules-${{ hashFiles('13-caching/react-app/package-lock.json') }}
         ```  
      iv. Czwarty krok – podobny do wcześniej zaimplementowanego kroku **Download cached dependencies**, ale powinien używać wyniku kroku `cache-key` zamiast wpisanego na stałe klucza cache’a.  
      v. Piąty krok – podobny do wcześniej zaimplementowanego kroku **Install dependencies**.  
   d. Zadanie powinno mieć jeden wynik (`output`) o nazwie `deps-cache-key`, którego wartość pochodzi z `CACHE_KEY` wygenerowanego w kroku `cache-key`.

2. **Dodaj nowe zadanie o nazwie `linting`:**
   a. Zadanie powinno działać na `ubuntu-latest`.  
   b. Powinno uruchamiać się tylko wtedy, gdy zadanie `install-deps` zakończy się powodzeniem.  
   c. Powinno ustawić `13-caching/react-app` jako domyślny katalog roboczy (`working-directory`) dla poleceń `run`.  
   d. Powinno zawierać pięć kroków:  
      i. **Checkout code** – pobiera kod repozytorium.  
      ii. **Setup Node** – ustawia wersję Node przekazaną jako parametr.  
      iii. Krok podobny do **Download cached dependencies**, ale powinien używać wyniku zadania `install-deps` zamiast wpisanego na stałe klucza cache’a i nie powinien zależeć od parametru `use-cache`.  
      iv. **Testing** – uruchamia skrypt `npm run test`.  
      v. **Linting** – wyświetla komunikat `"Linting..."` na ekranie.

3. **Zmodyfikuj zadanie `build`:**
   a. Dodaj zależność od zadania `install-deps`.  
   b. Usuń krok **Install dependencies**, ponieważ zależności będą zawsze pochodzić z cache’a.  
   c. Zaktualizuj krok **Download cached dependencies**, aby używał wyniku zadania `install-deps` zamiast wpisanego na stałe klucza cache’a.  
      Dodatkowo nie powinien już zależeć od parametru `use-cache`, ponieważ cache staje się wymagany do poprawnego działania zadania.

4. **Zatwierdź zmiany i wypchnij kod.**  
   Uruchom workflow kilka razy i porównaj czasy wykonywania poszczególnych kroków.  
   Jak długo trwa instalacja zależności? Jak długo trwałoby to przy 1000 uruchomieniach?

---
