# Practical Exercise 09 — Organization, Repository, and Environment Variables / Ćwiczenie praktyczne 09 — Zmienne organizacyjne, repozytoryjne i środowiskowe

## EN — Exercise Description
In this practical exercise, our goal is to deepen our knowledge around how to use organization, repository, and Environment (GitHub Environments) variables.

Here are the instructions for the exercise:

1. If you are using organizations, you will be able to create organization-level variables. If not, then simply skip the steps and script lines of this exercise that require organization-level variables. All the steps that require organization features are marked as such.
2. **[Requires Organizations]** — Create two organization-level variables:
   - a. `ORG_VAR`, should contain the value `'organization value'`
   - b. `OVERWRITTEN_VAR`, should contain the value `'organization value 2'`
3. Create a single repository-level variable:
   - a. `REPOSITORY_VAR`, should contain the value `'repository value'`
4. Create two new Environments (if you are not sure how to do it, check the **Tips** section below):
   - a. The first Environment should be named `prod`. Additionally, create two Environment variables:
     - i. `TARGET_VAR`, should contain the value `'prod'`
     - ii. `OVERWRITTEN_VAR`, should contain the value `'prod value'`
   - b. The second Environment should be named `staging`. Additionally, create one Environment variable:
     - i. `TARGET_VAR`, should contain the value `'staging'`
5. Extend the workflow named `08-variables.yaml`:
   - a. Add a third env variable at the workflow-level definition (next to the `OVERWRITTEN` env variable):
     - i. Name it `UNDEFINED_VAR_WITH_DEFAULT`
     - ii. Retrieve its value from the `UNDEFINED_VAR` variable from within the `vars` context
     - iii. If `UNDEFINED_VAR` is not defined, provide `'default value'` as the default value.
   - b. Add a second job named `echo2`:
     - i. The job should run on `ubuntu-latest`
     - ii. It should contain a single step, named `Print Variables`, which prints the following information on the screen:
       -  i. **[Requires Organizations]** — "Org var: <retrieve the value of ORG_VAR here>"
       -  ii. **[Requires Organizations]** — "Org overwritten var: <retrieve the value of OVERWRITTEN_VAR here>"
       -  iii. "Repo var: <retrieve the value of REPOSITORY_VAR here>"
   - c. Add a third job named `echo-prod`:
     - i. The job should run on `ubuntu-latest`
     - ii. Set the environment of this job to `prod`. If you are not sure how to set the job's environment, check the **Tips** section below.
     - iii. It should contain a single step, named `Print Prod Variables`, which prints the following information on the screen:
       -  i. **[Requires Organizations]** — "Org var: <retrieve the value of ORG_VAR here>"
       -  ii. "Org overwritten var: <retrieve the value of OVERWRITTEN_VAR here>"
       -  iii. "Repo var: <retrieve the value of REPOSITORY_VAR here>"
       -  iv. "Environment var: <retrieve the value of TARGET_VAR here>"
   - d. Add a fourth job named `echo-undefined`:
     - i. The job should run on `ubuntu-latest`
     - ii. It should contain a single step, named `Print Undefined Variables`, which prints the following information on the screen:
       -  i. "Org var: <retrieve the value of UNDEFINED_VAR_WITH_DEFAULT here>"
6. Commit the changes and push the code. Take a few moments to inspect the result of the workflow run triggered by the push event.
7. Try to alternate the Environments between `prod` and `staging`. How does this impact the output of the workflow runs?
8. Change the workflow triggers to contain only `workflow_dispatch` to prevent this workflow from running with every push and polluting the list of workflow runs.

### EN — Tips
**Creating Environments in GitHub**

To create Environments in GitHub:

1. Navigate to Your Repository: Go to your repository on GitHub where you want to create the environments.
2. Access Repository Settings: Click on the “Settings” tab at the top of the repository page.
3. Go to Environments: In the left sidebar, scroll down to the “Code and automation” section and click on “Environments”.
4. Create a New Environment: Click the “New environment” button on the right, enter the environment name, and click on "Configure Environment".
5. Add Environment Variables:
   - a. Scroll down to the “Environment variables” section.
   - b. Click on “Add variable”.
   - c. Enter the Name (e.g., `TARGET_VAR`) and Value (e.g., `prod` or `staging`).
   - d. Click “Add variable” to save.
   - e. Repeat this step to add additional variables as needed.
6. Once you’ve added all necessary secrets and variables, your environment is ready to use.

**Setting the Environment for a specific job**

To set the environment for a specific job in your GitHub Actions workflow:

1. Edit Your Workflow File: Open the respective workflow file in your repository.
2. Specify the Environment in the Job: Under the specific job you want to set the environment for (e.g., `echo-prod`), add the `environment` key. Here is one example of configuring the environment:

```yaml
jobs:
  echo-prod:
    runs-on: ubuntu-latest
    environment: prod  # Set the environment to 'prod'
    steps:
      - name: Print Prod Variables
        run: |
          # Your commands here
```

---

## PL — Opis ćwiczenia
W tym ćwiczeniu praktycznym naszym celem jest pogłębienie wiedzy o tym, jak używać zmiennych na poziomie organizacji, repozytorium oraz w środowiskach (GitHub Environments).

Oto instrukcje do ćwiczenia:

1. Jeśli korzystasz z organizacji, możesz tworzyć zmienne na poziomie organizacji. Jeśli nie — po prostu pomiń kroki i linie skryptu z tego ćwiczenia, które wymagają zmiennych organizacyjnych. Wszystkie kroki wymagające funkcji organizacji są odpowiednio oznaczone.
2. **[Wymaga organizacji]** — Utwórz dwie zmienne na poziomie organizacji:
   - a. `ORG_VAR` — powinna zawierać wartość `'organization value'`
   - b. `OVERWRITTEN_VAR` — powinna zawierać wartość `'organization value 2'`
3. Utwórz jedną zmienną na poziomie repozytorium:
   - a. `REPOSITORY_VAR` — powinna zawierać wartość `'repository value'`
4. Utwórz dwa nowe środowiska (jeśli nie wiesz jak, zajrzyj do sekcji **Tips** poniżej):
   - a. Pierwsze środowisko powinno nazywać się `prod`. Dodatkowo utwórz dwie zmienne środowiskowe:
     - i. `TARGET_VAR` — powinna zawierać wartość `'prod'`
     - ii. `OVERWRITTEN_VAR` — powinna zawierać wartość `'prod value'`
   - b. Drugie środowisko powinno nazywać się `staging`. Dodatkowo utwórz jedną zmienną środowiskową:
     - i. `TARGET_VAR` — powinna zawierać wartość `'staging'`
5. Rozszerz workflow o nazwie `08-variables.yaml`:
   - a. Dodaj trzecią zmienną środowiskową na poziomie workflow (obok zmiennej `OVERWRITTEN`):
     - i. Nazwij ją `UNDEFINED_VAR_WITH_DEFAULT`
     - ii. Pobierz jej wartość ze zmiennej `UNDEFINED_VAR` z kontekstu `vars`
     - iii. Jeśli `UNDEFINED_VAR` nie jest zdefiniowana, ustaw wartość domyślną `'default value'`.
   - b. Dodaj drugi job o nazwie `echo2`:
     - i. Job powinien działać na `ubuntu-latest`
     - ii. Powinien zawierać jeden krok `Print Variables`, który wypisze na ekranie następujące informacje:
       -  i. **[Wymaga organizacji]** — "Org var: <tu pobierz wartość ORG_VAR>"
       -  ii. **[Wymaga organizacji]** — "Org overwritten var: <tu pobierz wartość OVERWRITTEN_VAR>"
       -  iii. "Repo var: <tu pobierz wartość REPOSITORY_VAR>"
   - c. Dodaj trzeci job o nazwie `echo-prod`:
     - i. Job powinien działać na `ubuntu-latest`
     - ii. Ustaw środowisko dla tego joba na `prod`. Jeśli nie wiesz, jak ustawić środowisko joba, zajrzyj do sekcji **Tips** poniżej.
     - iii. Powinien zawierać jeden krok `Print Prod Variables`, który wypisze na ekranie następujące informacje:
       -  i. **[Wymaga organizacji]** — "Org var: <tu pobierz wartość ORG_VAR>"
       -  ii. "Org overwritten var: <tu pobierz wartość OVERWRITTEN_VAR>"
       -  iii. "Repo var: <tu pobierz wartość REPOSITORY_VAR>"
       -  iv. "Environment var: <tu pobierz wartość TARGET_VAR>"
   - d. Dodaj czwarty job o nazwie `echo-undefined`:
     - i. Job powinien działać na `ubuntu-latest`
     - ii. Powinien zawierać jeden krok `Print Undefined Variables`, który wypisze na ekranie następującą informację:
       -  i. "Org var: <tu pobierz wartość UNDEFINED_VAR_WITH_DEFAULT>"
6. Zacommituj zmiany i wypchnij kod. Poświęć chwilę na sprawdzenie wyniku uruchomienia workflow, wywołanego przez zdarzenie push.
7. Spróbuj przełączać środowiska między `prod` a `staging`. Jak to wpływa na wynik uruchomień workflow?
8. Zmień wyzwalacze workflow tak, aby zawierały tylko `workflow_dispatch`, aby zapobiec uruchamianiu tego workflow przy każdym pushu i nie zaśmiecać listy uruchomień.

### PL — Wskazówki
**Tworzenie Environments w GitHubie**

Aby utworzyć Environments w GitHubie:

1. Przejdź do swojego repozytorium: otwórz repozytorium na GitHubie, w którym chcesz tworzyć środowiska.
2. Wejdź w ustawienia repozytorium: kliknij kartę „Settings” na górze strony repozytorium.
3. Przejdź do Environments: w lewym pasku bocznym przewiń do sekcji „Code and automation” i kliknij „Environments”.
4. Utwórz nowe środowisko: kliknij przycisk „New environment” po prawej, wpisz nazwę środowiska i kliknij „Configure Environment”.
5. Dodaj zmienne środowiskowe:
   - a. Przewiń do sekcji „Environment variables”.
   - b. Kliknij „Add variable”.
   - c. Wpisz Name (np. `TARGET_VAR`) i Value (np. `prod` lub `staging`).
   - d. Kliknij „Add variable”, aby zapisać.
   - e. Powtarzaj, aby dodać kolejne zmienne według potrzeb.
6. Po dodaniu wszystkich potrzebnych sekretów i zmiennych Twoje środowisko jest gotowe do użycia.

**Ustawianie środowiska dla konkretnego joba**

Aby ustawić środowisko dla konkretnego joba w workflow GitHub Actions:

1. Edytuj plik workflow: otwórz odpowiedni plik workflow w repozytorium.
2. Określ środowisko w definicji joba: dla wybranego joba (np. `echo-prod`) dodaj klucz `environment`. Przykład konfiguracji:

```yaml
jobs:
  echo-prod:
    runs-on: ubuntu-latest
    environment: prod  # Ustaw środowisko na 'prod'
    steps:
      - name: Print Prod Variables
        run: |
          # Twoje polecenia tutaj
```
